!function(e){function t(t,n){t=e(t);var a=window.innerHeight,i=window.innerWidth,o=t.height(),r=t.width(),d={};switch(n){case"top":d.top=-(a/2+o)+"px",d.left="50%";break;case"left":d.left=-(i/2+r)+"px",d.top="50%";break;case"right":d.left=i/2+1.5*r+"px",d.top="50%";break;case"bottom":d.top=a+2*o+"px",d.left="50%"}return d}function n(){e("head").append('<link rel="stylesheet" href="../src/hp-metrics.css" type="text/css"</link>')}function a(e,t,n){var a=document.createElement(e);return a.classList.add(t),n&&(a.innerHTML=n),a}e.fn.hpModal=function(n,a,i){var o=e.extend({entrance:"fade",startPlacement:"top",speed:"fast",removeBackground:!1},a),r={slide:function(n){var a,r={};switch(o.startPlacement){case"right":a="left";break;case"bottom":a="top";break;default:a=o.startPlacement}r[a]="50%",e(".hp-metrics-modal__background",n.toggle()).fadeIn("fast",function(){var a=e(".hp-metrics-modal__inner",n).toggle();a.css(t(a,o.startPlacement)).animate(r,o.speed,i())})},fade:function(t){e(".hp-metrics-modal__background",t).toggle(),t.fadeIn("fast",function(){e(".hp-metrics-modal__inner",t).fadeIn(o.speed,i())})}},d={slide:function(n){var a=e(".hp-metrics-modal__inner",n);a.animate(t(a,o.startPlacement),o.speed,i()),o.removeBackground!==!1&&e(".hp-metrics-modal__background",n).fadeOut("fast")},fade:function(t){t.fadeOut("fast",function(){e(".hp-metrics-modal__inner",t).fadeOut(o.speed,i()),o.removeBackground!==!1&&e(".hp-metrics-modal__background",t).fadeOut("fast")})}};switch(n){case"open":r[o.entrance](this);break;case"replaceContent":var c=e(".hp-metrics-modal__inner");c.html(o.content);break;case"close":d[o.entrance](this)}return this},e.hpMetrics=function(t){n();var i=e.extend({entrance:"fade",startPlacement:"top",speed:"fast",removeBackground:!1},t),o=this;this.sendAnalytics=function(t){e.ajax({type:"POST",url:"http://hopo.dev/cors/analytic",data:t,crossDomain:!0,success:function(e){"zip_required"===e.response?setTimeout(function(){r.hpModal("replaceContent",{content:o.createZipContent()})},1e3):"no_zip"===e.response&&(setTimeout(function(){r.hpModal("replaceContent",{content:o.createOutroContent()})},1e3),setTimeout(function(){r.hpModal("close",i,function(){o.redirectPage("http://google.com")})},1500))},error:function(e,t,n){window.console.log(e,t,n)}})},this.redirectPage=function(e,t){var n=e;if(t){n+="?";for(var a in t)n=n+a+"="+t[a]+"&";n=n.replace(/&$/,"")}window.location.assign(n)},this.createModal=function(){var t=document.createElement("div");t.classList.add("hp-metrics-modal");var n=document.createElement("div");n.classList.add("hp-metrics-modal__background"),t.appendChild(n);var a=document.createElement("div");a.classList.add("hp-metrics-modal__inner");var i=this.createInitialContent();return a.appendChild(i),t.appendChild(a),e("body").append(t),e(t)},this.createCloseButton=function(){var e=a("a","hp-metrics-modal__close","Close");return e.setAttribute("href",""),e},this.submitZip=function(){var t=e(".hp-metrics-modal__zip-field").val();/^\d{5}$/.test(t)?(e(".hp-metrics-modal__error").text(""),r.hpModal("replaceContent",{content:o.createOutroContent()}),setTimeout(function(){r.hpModal("close",e.extend({removeBackground:!1},i),function(){o.redirectPage("http://google.com",{zip:t})})},1500)):e(".hp-metrics-modal__error").text("Invalid Zip Code.")},this.createInitialContent=function(){var e=a("div","hp-metrics-modal__initial"),t=a("h2","modal-header","Processing Request!");e.appendChild(t);var n=a("div","initial-loader"),i=a("div","loading-text","Loading");n.appendChild(i);for(var o=1;3>=o;o++){var r=a("div","loader");r.classList.add("l"+o),n.appendChild(r)}return e.appendChild(n),e.appendChild(this.createCloseButton()),e},this.createZipContent=function(){var e=a("div","hp-metrics-modal__zip"),t=a("h2","modal-header","Please Enter Your Zip.");e.appendChild(t);var n=a("div","zip-content"),i=a("input","hp-metrics-modal__zip-field");i.setAttribute("name","zip"),i.setAttribute("type","text"),i.setAttribute("placeholder","Zip Code"),n.appendChild(i);var o=a("button","hp-metrics-modal__zip-submit","Submit");n.appendChild(o);var r=a("div","hp-metrics-modal__error");return n.appendChild(r),e.appendChild(n),e.appendChild(this.createCloseButton()),e},this.createOutroContent=function(){var e=a("div","hp-metrics-modal__outro"),t=a("h2","modal-header","Thankyou!");e.appendChild(t);var n=a("div","outro-content"),i=a("div","outro-text","Redirecting to Somewhere!");return n.appendChild(i),e.appendChild(n),e.appendChild(this.createCloseButton()),e},this.resetModal=function(){r=this.createModal()};var r=this.createModal();e("[data-hp-metrics]").on("click",function(){r.hpModal("open",i,function(){o.sendAnalytics({test:"asdf"})})}),e(document).on("click",".hp-metrics-modal__zip-submit",function(){o.submitZip()}),e(document).on("click",".hp-metrics-modal a.hp-metrics-modal__close",function(e){e.preventDefault(),i.removeBackground=!0,r.hpModal("close",i,function(){o.resetModal()})})}}(jQuery);